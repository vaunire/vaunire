{% load humanize %}

<div class="space-y-4" id="cart-items-list">
    {% for item in cart.products.all %}
        <div class="flex flex-col bg-white rounded-lg shadow-sm font-montserrat border border-gray-200 relative transition-shadow hover:shadow-md">
            
            <!-- Верхняя часть: Фото, Инфо, Цена -->
            <div class="p-4 flex items-start w-full">
                <div class="flex items-start">
                    <!-- Кнопка удаления -->
                    <button class="text-gray-400 hover:text-gray-500 transition-colors duration-200 mr-3 mt-0.5" onclick="showDeleteModal('{{ item.content_object.ct_model }}', '{{ item.content_object.slug }}', '{{ item.display_name|escapejs }}', '{{ item.content_object.image.url|escapejs }}')">
                        <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>

                    <!-- Изображение -->
                    <div class="flex-shrink-0 relative">
                        <img src="{{ item.content_object.image.url }}" alt="{{ item.display_name }}" class="w-20 h-20 object-cover rounded-lg border border-gray-100">
                        {% if item.content_object.condition %}
                            <span class="absolute top-1 right-1 px-1.5 py-0.5 flex items-center justify-center font-normal tracking-wider font-geologica rounded text-[8px] bg-white/90 backdrop-blur-sm text-black border border-gray-100 shadow-sm">
                                {{ item.content_object.condition|truncatechars:2|upper }}
                            </span>
                        {% endif %}
                    </div>
                </div>

                <div class="flex-1 ml-5">
                    <div class="flex justify-between items-start">
                        <!-- Название, Жанры и ОПИСАНИЕ -->
                        <div class="max-w-[70%]"> 
                            <div class="flex items-center space-x-2.5">
                                <a href="{% url 'album_detail' artist_slug=item.content_object.artist.slug album_slug=item.content_object.slug %}" class="text-lg font-medium hover:text-blue-600 transition-colors duration-200 leading-tight">
                                    {{ item.display_name }}
                                </a>
                            </div>
                            <div class="text-sm">
                                <div class="text-[13px] font-normal text-gray-500 tracking-wider font-montserrat flex items-center gap-2">
                                    <span> 
                                    {% if item.content_object.styles.all %}
                                        {% for style in item.content_object.styles.all %}
                                            {{ style.name }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    {% endif %}</span>
                                </div>
                            </div>
                            {% with clean_desc=item.content_object.description|striptags %}
                                {% if clean_desc and "Описание появится позже" not in clean_desc %}
                                    <div class="mt-2 relative pl-5">
                                        <span class="absolute left-0 text-[35px] text-gray-400/65 font-serif leading-none select-none">
                                            “
                                        </span>
                                        <div class="text-[13px] text-black/75 font-normal tracking-wider font-montserrat leading-relaxed line-clamp-2">
                                            {{ clean_desc|truncatechars:160 }}
                                        </div>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        </div>

                        <!-- Правая часть: Цена и кнопки -->
                        {% include 'cart/controls/item_actions.html' %}
                    </div>
                </div>
            </div>

            <div class="w-full -mt-1 h-px bg-gray-100"></div>
            {% with album=item.content_object %}
            <!-- Нижняя часть: чипы -->
            <div class="px-5 py-3 -mt-[3px] bg-gray-50/30 rounded-b-lg">
                <div class="flex flex-wrap gap-2.5 tracking-wide">
                    
                    <!-- Предложение недели (Синий) -->
                    {% if album.offer_of_the_week %}
                        <span class="inline-flex items-center px-2.5 py-0.5 mt-0.5 rounded-md text-[11px] font-semibold bg-white text-orange-600 border border-orange-400 shadow-sm transition-colors duration-200 hover:border-orange-500 cursor-default">
                            <svg class="w-3.5 h-3.5 mr-1.5 text-orange-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd" />
                            </svg>
                            Хит месяца
                        </span>
                    {% endif %}

                    <!-- Акция (Синий) -->
                    {% if album.active_promotion %}
                        <span class="inline-flex items-center px-2.5 py-0.5 mt-0.5 rounded-md text-[11px] font-semibold bg-white text-blue-600 border border-blue-400 shadow-sm transition-colors duration-200 hover:border-blue-500 cursor-default" title="{{ album.active_promotion.description }}">
                            <svg class="w-3.5 h-3.5 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.3" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>
                            Акция
                        </span>
                    {% endif %}
                    
                    <!-- Автограф (Фиолетовый) -->
                    {% if album.has_autograph %}
                        <span class="inline-flex items-center px-2.5 py-0.5 mt-0.5 rounded-md text-[11px] font-semibold bg-white text-purple-600 border border-purple-400 shadow-sm transition-colors duration-200 hover:border-purple-500 cursor-default">
                            <svg class="w-3.5 h-3.5 mt-1 ml-0.5 mr-1.5 text-purple-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 576" fill="currentColor">
                                <path d="M623.2 128c-51.8 3.5-125.7 54.7-163.1 71.5-29.1 13.1-54.2 24.4-76.1 24.4-22.6 0-26-16.2-21.3-51.9 1.1-8 11.7-79.2-42.7-76.1-25.1 1.5-64.3 24.8-169.5 126L192 118.2c30.4-75.9-53.2-151.5-129.7-102.8L7.4 52.3C0 57-2.2 66.9 2.5 74.4l17.2 27c4.7 7.5 14.6 9.7 22.1 4.9l58-38.9c18.4-11.7 40.7 7.2 32.7 27.1L34.3 340.1C27.5 357 37 384 64 384c8.3 0 16.5-3.2 22.6-9.4 42.2-42.2 154.7-150.7 211.2-195.8-2.2 28.5-2.1 58.9 20.6 83.8 15.3 16.8 37.3 25.3 65.5 25.3 35.6 0 68-14.6 102.3-30 33-14.8 99-62.6 138.4-65.8 8.5-.7 15.2-7.3 15.2-15.8v-32.1c.2-9.1-7.5-16.8-16.6-16.2z"/>
                            </svg>  
                            Автограф
                        </span>
                    {% endif %}
            {% endwith %} 
                </div>
            </div>
        </div>
    {% endfor %}
</div>

{% include 'cart/modals/remove_from_cart.html' %}