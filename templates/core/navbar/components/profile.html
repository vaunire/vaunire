{% if not request.user.is_authenticated %}
    <!-- Кнопка входа -->
    <a href="{% url 'login' %}" class="relative ml-2.5">
        <span class="font-geologica font-semibold relative tracking-wider shadow-[0_2px_5px_-1px_rgb(0_0_0/0.07),_0_1px_3px_-1px_rgb(0_0_0/0.05)] shadow-blue-600 inline-flex items-center rounded-lg bg-blue-600 px-3.5 py-2 text-xs text-white transition duration-100 hover:bg-blue-700">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="mr-1.5 -ml-0.5">
                <path fill="currentColor" d="M7.995 2C6.154 2 4.662 3.465 4.662 5.273c0 1.807 1.492 3.272 3.333 3.272 1.84 0 3.332-1.465 3.332-3.272C11.327 3.465 9.835 2 7.995 2M5.161 9.262c.424-.17.889-.043 1.319.11a4.6 4.6 0 0 0 1.515.264c.518 0 1.031-.095 1.504-.26c.437-.153.909-.279 1.337-.105c.73.297 1.551.899 2.02 1.616a.876.876 0 0 1-.082 1.067C11.65 13.216 9.811 14 7.994 14s-3.643-.782-4.768-2.045a.88.88 0 0 1-.083-1.068c.471-.722 1.285-1.332 2.018-1.625"/>
            </svg>
            Войти
        </span>
    </a>
{% else %}
    <!-- Профиль с dropdown -->
    <div class="relative ml-3" x-data="{ isOpen: false }">
        <div class="group inline-block">
            <!-- Кнопка профиля -->
            <button @click.prevent="isOpen = !isOpen"
                    @mouseenter="isOpen = true"
                    class="relative flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg shadow-soft-md border border-gray-100 transition-all duration-300 group-hover:bg-white group-hover:shadow-sm [&:is(:focus-visible)]:ring-2 [&:is(:focus-visible)]:ring-blue-500"
                    :class="{ 'bg-white shadow-lg': isOpen }"
                    type="button">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 16 16" class="text-gray-400 opacity-80 transition-colors duration-300 group-hover:text-blue-600" :class="{ 'text-blue-600': isOpen }">
                    <path fill="currentColor" d="M7.995 2C6.154 2 4.662 3.465 4.662 5.273c0 1.807 1.492 3.272 3.333 3.272 1.84 0 3.332-1.465 3.332-3.272C11.327 3.465 9.835 2 7.995 2M5.161 9.262c.424-.17.889-.043 1.319.11a4.6 4.6 0 0 0 1.515.264c.518 0 1.031-.095 1.504-.26c.437-.153.909-.279 1.337-.105c.73.297 1.551.899 2.02 1.616a.876.876 0 0 1-.082 1.067C11.65 13.216 9.811 14 7.994 14s-3.643-.782-4.768-2.045a.88.88 0 0 1-.083-1.068c.471-.722 1.285-1.332 2.018-1.625"/>
                </svg>
                <span class="text-xs font-medium text-gray-400 mr-0.5 max-w-[90px] truncate transition-colors duration-300 group-hover:text-blue-600" :class="{ 'text-blue-600': isOpen }">
                    {{ request.user.username }}
                </span>
            </button>

            <!-- Dropdown меню -->
            <div x-show="isOpen"
                 x-cloak
                 @click.outside="isOpen = false"
                 @mouseenter="isOpen = true"
                 @mouseleave="isOpen = false"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 scale-95 translate-y-1"
                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-end="opacity-0 scale-95 translate-y-1"
                 class="absolute left-1/2 -translate-x-1/2 top-full mt-2.5 w-44 bg-white border border-gray-100 shadow-lg rounded-lg z-50 origin-top">
                <div class="py-1">
                    <a href="{% url 'account' %}" class="group/item flex items-center px-3 py-2 text-xs font-normal text-gray-600 hover:text-blue-700 hover:bg-blue-50 transition-all duration-200">
                        <svg class="text-gray-400 opacity-75 group-hover/item:text-blue-600 mr-2 transition-colors duration-200" xmlns="http://www.w3.org/2000/svg" width="17.5" height="17.5" viewBox="0 0 16 16">
                            <path fill="currentColor" d="M7.995 2C6.154 2 4.662 3.465 4.662 5.273c0 1.807 1.492 3.272 3.333 3.272 1.84 0 3.332-1.465 3.332-3.272C11.327 3.465 9.835 2 7.995 2M5.161 9.262c.424-.17.889-.043 1.319.11a4.6 4.6 0 0 0 1.515.264c.518 0 1.031-.095 1.504-.26c.437-.153.909-.279 1.337-.105c.73.297 1.551.899 2.02 1.616a.876.876 0 0 1-.082 1.067C11.65 13.216 9.811 14 7.994 14s-3.643-.782-4.768-2.045a.88.88 0 0 1-.083-1.068c.471-.722 1.285-1.332 2.018-1.625"/>
                        </svg>
                        Личный кабинет
                    </a>

                    <a href="{% url 'account_tab' 'wishlist' %}" class="group/item flex items-center px-3 py-2 text-xs font-normal text-gray-600 hover:text-blue-700 hover:bg-blue-50 transition-all duration-200">
                        <svg class="text-gray-400 opacity-75 group-hover/item:text-blue-600 mr-[9px] transition-colors duration-200" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024">
                            <path fill="currentColor" d="m908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5c-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 0 0 .6 45.3l183.7 179.1l-43.4 252.9a31.95 31.95 0 0 0 46.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2c17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9l183.7-179.1c5-4.9 8.3-11.3 9.3-18.3c2.7-17.5-9.5-33.7-27-36.3"/>
                        </svg>
                        Лист ожидания
                    </a>

                    <div class="border-t border-gray-200/70 my-1"></div>

                    <a href="{% url 'account_tab' 'orders' %}" class="group/item flex items-center px-3 py-2 text-xs font-normal text-gray-600 hover:text-blue-700 hover:bg-blue-50 transition-all duration-200">
                        <svg class="text-gray-400 opacity-75 group-hover/item:text-blue-600 mr-2.5 transition-colors duration-200" width="14.7" height="14.7" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M13.409 2.513a3.75 3.75 0 0 0-2.818 0l-2.19.888l9.592 3.73l3.374-1.303a1.8 1.8 0 0 0-.46-.275zM22 7.191l-9.25 3.574v10.923q.336-.068.659-.199l7.498-3.04A1.75 1.75 0 0 0 22 16.827zM11.25 21.688V10.765L2 7.191v9.637a1.75 1.75 0 0 0 1.093 1.621l7.498 3.04q.323.13.659.2M2.633 5.828L12 9.447l3.917-1.514l-9.543-3.71l-3.281 1.33q-.256.104-.46.275"/>
                        </svg>
                        Мои заказы
                    </a>

                    <a href="{% url 'account_tab' 'returns' %}" class="group/item flex items-center px-3 py-2 text-xs font-normal text-gray-600 hover:text-blue-700 hover:bg-blue-50 transition-all duration-200">
                        <svg class="text-gray-400 opacity-75 group-hover/item:text-blue-600 mr-[9px] transition-colors duration-200" xmlns="http://www.w3.org/2000/svg" width="15.5" height="15.5" viewBox="0 0 1200 1200">
                            <path fill="currentColor" d="M300 225L0 525h225v375h450L525 750H375V525h225zm225 75l150 150h150v225H600l300 300l300-300H975V300z"/>
                        </svg>
                        Мои возвраты
                    </a>

                    <div class="border-t border-gray-200/70 my-1"></div>

                    <form method="post" action="{% url 'logout' %}" class="block w-full">
                        {% csrf_token %}
                        <button type="submit" class="w-full flex items-center px-3 py-2 text-xs font-normal text-red-600 hover:bg-red-50 transition-all duration-200">
                            <svg class="ml-0.5 mr-2 text-red-500 opacity-75" xmlns="http://www.w3.org/2000/svg" width="14" height="14" stroke-width="0.45" stroke="currentColor" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h7v2H5v14h7v2zm11-4l-1.375-1.45l2.55-2.55H9v-2h8.175l-2.55-2.55L16 7l5 5z"/>
                            </svg>
                            Выход
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endif %}